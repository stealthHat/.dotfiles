#!/bin/bash

installpkg(){ sudo pacman --noconfirm --needed -S "$1" ;}
aurinstall(){ yay --noconfirm -S "$1" ;}

# Set the best mirros for my country
mirrorSettings () {
  sudo pacman -S reflector --noconfirm 
  reflector -c Brazil -a 6 --sort rate --save /etc/pacman.d/mirrolist 
  sudo pacman -Syuu --noconfirm
}

pacmanconfig () { 
  grep -q "^Color" /etc/pacman.conf || sed -i "s/^#Color$/Color/" /etc/pacman.conf
  grep -q "ILoveCandy" /etc/pacman.conf || sed -i "/#VerbosePkgLists/a ILoveCandy" /etc/pacman.conf
}

yay () {
  cd $HOME/git && git clone https://aur.archlinux.org/yay.git
  cd $HOME/git/yay && makepkg -si PKGBUILD --noconfirm
}

basepkgs () {
  for x in curl base-devel git; do
  	installpkg "$x"
  done
}

creteLinks () {
  mkdir -pv $HOME/.local/bin 
  mkdir -pv $HOME/.config/tmux

  ln -sfv $HOME/git/.dotfiles/home/.zprofile $HOME/  
  ln -sfv $HOME/git/.dotfiles/home/.tmux.conf $HOME/ 
  ln -sfv $HOME/git/.dotfiles/home/.xinitrc $HOME/
  ln -sfv $HOME/git/.dotfiles/home/.config/* $HOME/.config/ 
  ln -sfv $HOME/git/.dotfiles/home/.local/bin/* $HOME/.local/bin/

  source $HOME/.zprofile
  source $HOME/.config/zsh/.zshrc
}

installLoop () {
  while IFS=, read -r tag program comment; do 
    [[ "$tag" =~ ^#.*$ ]] && continue
    case "$tag" in
			"A") aurinstall "$program" ;;
			*) installpkg "$program" ;;
		esac
  done < $HOME/git/.dotfiles/install/progs.csv 
}

zsh () {
  export ZSH=$HOME/.config/zsh/.oh-my-zsh 
  chsh -s $(which zsh) 
  sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" 
}

nvim () {
  curl -fLo ~/.local/share/nvim/site/autoload/plug.vim --create-dir\
         https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
  gpg --keyserver hkp://keys.gnupg.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3
  curl -sSL https://get.rvm.io | bash -s -- --path $HOME/.local/rvm
  rvm install stable
  gem install neovim 
}

tmuxplug () {
  git clone https://github.com/tmux-plugins/tpm $HOME/.config/tmux/plugins/tpm
}


dwmTools () {
  cd $HOME/git
  git clone https://git.suckless.org/dwm 
  git clone https://git.suckless.org/dmenu 
  pushd dwm && sudo make install 
  popd 
  pushd dmenu && sudo make install 
}


cleanUp () {
  cd $HOME
  rm -rf .bash* & .zshrc & .mkshrc & .profile
}


mirrorSettings 
pacmanconfig 
yay
basepkgs 
creteLinks
installLoop
zsh
nvim
tmuxplug
dwmTools
cleanUp
